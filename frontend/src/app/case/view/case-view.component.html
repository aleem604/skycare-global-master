<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title class="pageTitle">{{pageTitle}}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="pageHolder" fullscreen>

  <ion-fab vertical="top" horizontal="end" slot="fixed" style="margin-top: 35px;">
    <ion-fab-button (click)="formatTextFabButtons()">
      <ion-icon name="create"></ion-icon>
    </ion-fab-button>
    <ion-fab-list side="bottom">
      <ion-fab-button class="text-fab" *ngIf="shouldShowButton('editCase')" (click)="editCase($event, currentCase.caseID)">Edit Case Details</ion-fab-button>
      <ion-fab-button class="text-fab" *ngIf="shouldShowButton('changeStatus')" (click)="editCaseStatus($event)">Change Status</ion-fab-button>
      <ion-fab-button class="text-fab" *ngIf="shouldShowButton('patientConsent')" (click)="editConsent($event)">Patient Consent</ion-fab-button>
      <ion-fab-button class="text-fab" *ngIf="shouldShowButton('preflightAssess')" (click)="editPreflightAssessment($event)">Pre-Flight Assess</ion-fab-button>
      <ion-fab-button class="text-fab" *ngIf="shouldShowButton('receivePatient')" (click)="startProgressNote($event)">Receive Patient</ion-fab-button>
      <ion-fab-button class="text-fab" *ngIf="shouldShowButton('progressNote')" (click)="editProgressNote($event)">Progress Note</ion-fab-button>
      <ion-fab-button class="text-fab" *ngIf="shouldShowButton('transferPatient')" (click)="finishProgressNote($event)">Discharge Patient</ion-fab-button>
      <ion-fab-button class="text-fab" *ngIf="shouldShowButton('travelReceipt')" (click)="uploadNewEscortReceipt($event)">Travel Receipt</ion-fab-button>
      <ion-fab-button class="text-fab" *ngIf="shouldShowButton('sendMessage')" (click)="showSendMessage()">Send Message</ion-fab-button>
      <ion-fab-button class="text-fab" *ngIf="shouldShowButton('appFeedback')" (click)="showAppFeedback($event)">App Feedback</ion-fab-button>
    </ion-fab-list>
  </ion-fab>

  <mat-accordion class="view-case-accordion" #accordion>

    <mat-expansion-panel hideToggle expanded>
      <mat-expansion-panel-header>
        <mat-panel-title class="blueButton">
          General Info
        </mat-panel-title>
        <mat-panel-description>
          &nbsp;<ion-label style="font-size: 17px; white-space: nowrap;">{{ currentCase.currentStatus }}</ion-label>
        </mat-panel-description>
      </mat-expansion-panel-header>

      <ion-list class="pageHolder">
        <ion-item>
          <ion-label position="stacked">Patient Name</ion-label>
          <div class="caseDetailsField">{{ currentCase.patientFirstName }}&nbsp;{{ currentCase.patientLastName }}</div>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Client Name</ion-label>
          <div class="caseDetailsField">{{ currentCase.companyName }}</div>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Origin Airport</ion-label>
          <div class="caseDetailsField">{{ currentCase.originCity }}</div>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Destination Airport</ion-label>
          <div class="caseDetailsField">{{ currentCase.destinationCity }}</div>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Show Current Location</ion-label>
          <div *ngIf="mapLinkDisabled">Available once Escort picks up Patient to start transport</div>
          <div *ngIf="!currentlyOnline">Tracking location unavailable while you are offline</div>
          <div *ngIf="!mapLinkDisabled && noTrackingData && currentlyOnline">Escort now with patient enroute to destination</div>
          <div *ngIf="!mapLinkDisabled && !noTrackingData && currentlyOnline">
            <span>Escort now with patient enroute to destination - </span>
            <span class="externalLink" (click)="showCurrentLocation()">Track here on Google Maps</span>
          </div>
        </ion-item>
      </ion-list>
    </mat-expansion-panel>

    <mat-expansion-panel hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title class="blueButton">
          Hospital Medical Notes
        </mat-panel-title>
      </mat-expansion-panel-header>

      <ion-list>
        <ion-item class="viewableFile" *ngFor="let medicalNote of caseDocs.medicalNote">
          <ion-label (click)="showUploadedFile(medicalNote.documentID, medicalNote.type)" class="externalLink">{{medicalNote.name}}</ion-label>
        </ion-item>
        <ion-item *ngIf="(caseDocs.medicalNote === undefined || caseDocs.medicalNote.length == 0) && currentUserIsAdmin">
          <ion-label (click)="promptToEditCase($event)" class="externalLink">No Medical Notes for this Case</ion-label>
        </ion-item>
        <ion-item *ngIf="(caseDocs.medicalNote === undefined || caseDocs.medicalNote.length == 0) && !currentUserIsAdmin">
          <ion-label>No Medical Notes for this Case</ion-label>
        </ion-item>
      </ion-list>
    </mat-expansion-panel>

    <mat-expansion-panel hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title class="blueButton">
          Passports
        </mat-panel-title>
      </mat-expansion-panel-header>

      <ion-list>
        <ion-item class="viewableFile" *ngFor="let passport of caseDocs.passport">
          <ion-label (click)="showUploadedFile(passport.documentID, passport.type)" class="externalLink">{{passport.name}}</ion-label>
        </ion-item>
        <ion-item *ngIf="(caseDocs.passport === undefined || caseDocs.passport.length == 0) && currentUserIsAdmin">
          <ion-label (click)="promptToEditCase($event)" class="externalLink">No Passports for this Case</ion-label>
        </ion-item>
        <ion-item *ngIf="(caseDocs.passport === undefined || caseDocs.passport.length == 0) && !currentUserIsAdmin">
          <ion-label>No Passports for this Case</ion-label>
        </ion-item>
      </ion-list>
    </mat-expansion-panel>

    <mat-expansion-panel hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title class="blueButton">
          Airline Clearances
        </mat-panel-title>
      </mat-expansion-panel-header>

      <ion-list>
        <ion-item class="viewableFile" *ngFor="let airlineClearance of caseDocs.airlineClearance">
          <ion-label (click)="showUploadedFile(airlineClearance.documentID, airlineClearance.type)" class="externalLink">{{airlineClearance.name}}</ion-label>
        </ion-item>
        <ion-item *ngIf="(caseDocs.airlineClearance === undefined || caseDocs.airlineClearance.length == 0) && currentUserIsAdmin">
          <ion-label (click)="promptToEditCase($event)" class="externalLink">No Airline Clearances for this Case</ion-label>
        </ion-item>
        <ion-item *ngIf="(caseDocs.airlineClearance === undefined || caseDocs.airlineClearance.length == 0) && !currentUserIsAdmin">
          <ion-label>No Airline Clearances for this Case</ion-label>
        </ion-item>
      </ion-list>
    </mat-expansion-panel>

    <mat-expansion-panel hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title class="blueButton">
          Air
        </mat-panel-title>
      </mat-expansion-panel-header>

      <ion-list>
        <ion-item class="viewableFile" *ngFor="let air of caseDocs.air">
          <ion-label (click)="showUploadedFile(air.documentID, air.type)" class="externalLink">{{air.name}}</ion-label>
        </ion-item>
        <ion-item *ngIf="(caseDocs.air === undefined || caseDocs.air.length == 0) && currentUserIsAdmin">
          <ion-label (click)="promptToEditCase($event)" class="externalLink">No Air Docs for this Case</ion-label>
        </ion-item>
        <ion-item *ngIf="(caseDocs.air === undefined || caseDocs.air.length == 0) && !currentUserIsAdmin">
          <ion-label>No Air Docs for this Case</ion-label>
        </ion-item>
      </ion-list>
    </mat-expansion-panel>

    <mat-expansion-panel hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title class="blueButton">
          Hotel
        </mat-panel-title>
      </mat-expansion-panel-header>

      <ion-list>
        <ion-item class="viewableFile" *ngFor="let hotel of caseDocs.hotel">
          <ion-label (click)="showUploadedFile(hotel.documentID, hotel.type)" class="externalLink">{{hotel.name}}</ion-label>
        </ion-item>
        <ion-item *ngIf="(caseDocs.hotel === undefined || caseDocs.hotel.length == 0) && currentUserIsAdmin">
          <ion-label (click)="promptToEditCase($event)" class="externalLink">No Hotel Docs for this Case</ion-label>
        </ion-item>
        <ion-item *ngIf="(caseDocs.hotel === undefined || caseDocs.hotel.length == 0) && !currentUserIsAdmin">
          <ion-label>No Hotel Docs for this Case</ion-label>
        </ion-item>
      </ion-list>
    </mat-expansion-panel>

    <mat-expansion-panel hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title class="blueButton">
          Ground
        </mat-panel-title>
      </mat-expansion-panel-header>

      <ion-list>
        <ion-item class="viewableFile" *ngFor="let ground of caseDocs.ground">
          <ion-label (click)="showUploadedFile(ground.documentID, ground.type)" class="externalLink">{{ground.name}}</ion-label>
        </ion-item>
        <ion-item *ngIf="(caseDocs.ground === undefined || caseDocs.ground.length == 0) && currentUserIsAdmin">
          <ion-label (click)="promptToEditCase($event)" class="externalLink">No Ground Docs for this Case</ion-label>
        </ion-item>
        <ion-item *ngIf="(caseDocs.ground === undefined || caseDocs.ground.length == 0) && !currentUserIsAdmin">
          <ion-label>No Ground Docs for this Case</ion-label>
        </ion-item>
      </ion-list>
    </mat-expansion-panel>

    <mat-expansion-panel hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title style="margin-top:12px;" class="blueButton">
          Patient Consent
        </mat-panel-title>
        <mat-panel-description>
          &nbsp;
          <mat-icon *ngIf="currentCase.patientConsent === undefined" style="color: orange;">warning</mat-icon>
          <mat-icon *ngIf="currentCase.patientConsent !== undefined" style="color: green;">check_circle</mat-icon>
        </mat-panel-description>
      </mat-expansion-panel-header>
      <ion-list>
        <ion-item class="" *ngIf="currentCase.patientConsent === undefined">
          <ion-label *ngIf="currentRole == 'escort'" (click)="editConsent($event)" class="externalLink">TO BE DONE</ion-label>
          <ion-label *ngIf="currentRole != 'escort'">TO BE DONE</ion-label>
        </ion-item>
        <ion-item class="" *ngIf="currentCase.patientConsent !== undefined">
          <ion-label (click)="showSignedConsent()" class="externalLink">View Signed Consent</ion-label>
        </ion-item>
      </ion-list>
    </mat-expansion-panel>

    <mat-expansion-panel hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title style="margin-top:12px;" class="blueButton">
          Pre-flight Assessment
        </mat-panel-title>
        <mat-panel-description>
          &nbsp;
          <mat-icon *ngIf="currentCase.patientAssessment === undefined" style="color: orange;">warning</mat-icon>
          <mat-icon *ngIf="currentCase.patientAssessment !== undefined" style="color: green;">check_circle</mat-icon>
        </mat-panel-description>
      </mat-expansion-panel-header>
      <ion-list>
        <ion-item class="" *ngIf="currentCase.patientAssessment === undefined && nonFinalizedPatientAssessment === undefined">
          <ion-label *ngIf="currentRole == 'escort'" (click)="editPreflightAssessment($event)" class="externalLink">TO BE DONE</ion-label>
          <ion-label *ngIf="currentRole != 'escort'">TO BE DONE</ion-label>
        </ion-item>
        <ion-item class="" *ngIf="currentCase.patientAssessment === undefined && nonFinalizedPatientAssessment !== undefined">
          <ion-label *ngIf="currentRole == 'escort'" (click)="editPreflightAssessment($event)" class="externalLink">ONGOING</ion-label>
          <ion-label *ngIf="currentRole != 'escort'">ONGOING</ion-label>
        </ion-item>
        <ion-item class="" *ngIf="currentCase.patientAssessment !== undefined">
          <ion-label (click)="showSignedAssessment()" class="externalLink">View Signed Assessment</ion-label>
        </ion-item>
      </ion-list>
    </mat-expansion-panel>

    <mat-expansion-panel hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title style="margin-top:12px;" class="blueButton">
          Progress Notes
        </mat-panel-title>
        <mat-panel-description>
          &nbsp;
          <mat-icon *ngIf="currentCase.patientProgress === undefined" style="color: orange;">warning</mat-icon>
          <mat-icon *ngIf="currentCase.patientProgress !== undefined" style="color: green;">check_circle</mat-icon>
        </mat-panel-description>
      </mat-expansion-panel-header>
      <ion-list>
        <ion-item class="" *ngIf="currentCase.patientProgress === undefined && nonFinalizedPatientProgress === undefined">
          <ion-label *ngIf="currentRole == 'escort'" (click)="startProgressNote($event)" class="externalLink">TO BE DONE</ion-label>
          <ion-label *ngIf="currentRole != 'escort'">TO BE DONE</ion-label>
        </ion-item>
        <ion-item class="" *ngIf="currentCase.patientProgress === undefined && nonFinalizedPatientProgress !== undefined">
          <ion-label *ngIf="currentRole == 'escort'" (click)="editProgressNote($event)" class="externalLink">ONGOING</ion-label>
          <ion-label *ngIf="currentRole != 'escort'">ONGOING</ion-label>
        </ion-item>
        <ion-item class="" *ngIf="currentCase.patientProgress !== undefined">
          <ion-label (click)="showSignedProgressNotes()" class="externalLink">View Signed Progress Notes</ion-label>
        </ion-item>
      </ion-list>
    </mat-expansion-panel>

    <mat-expansion-panel hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title style="margin-top:12px;" class="blueButton">
          Travel Receipts
        </mat-panel-title>
        <mat-panel-description>
          &nbsp;
          <mat-icon #travelReceiptsIcon style="color: orange;">warning</mat-icon>
        </mat-panel-description>
      </mat-expansion-panel-header>

      <ion-list>
        <ion-item class="" *ngIf="escortReceipts.length == 0">
          <ion-label *ngIf="currentRole != 'escort'">NO RECEIPTS YET</ion-label>
          <ion-label *ngIf="currentRole == 'escort'" class="externalLink" (click)="uploadNewEscortReceipt($event)">NO RECEIPTS YET</ion-label>
        </ion-item>        
        <ion-item class="viewableFile" *ngFor="let receipt of escortReceipts" (click)="showUploadedFile(receipt.receiptID, 'receipt')" style="border: solid 1px black;">
          <ion-grid class="flex-field-grid">
            <ion-row>
              <ion-col size="11"><ion-label class="compactData">{{receipt.name}}</ion-label></ion-col>
              <ion-col size="1"><ion-icon (click)="deleteUploadedFile($event, receipt.receiptID, 'receipt')" name="trash" class="icon-button"></ion-icon></ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="11"><ion-label class="compactData">{{getEscortName(receipt.escortID)}}</ion-label></ion-col>
              <ion-col size="1"><ion-icon (click)="showUploadedFile(receipt.receiptID, 'receipt')" name="eye" class="icon-button" style="top:20px;"></ion-icon></ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="12"><ion-label class="compactData">{{ receipt.alternateName }}</ion-label></ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="6" style="text-align: left; align-items: left;">$ {{receipt.usdAmount}}</ion-col>
              <ion-col size="6" style="text-align: right; align-items: right;">{{receipt.receiptDate | date:'shortDate'}}</ion-col>
            </ion-row>
          </ion-grid>
        </ion-item>
      </ion-list>
    </mat-expansion-panel>

    <mat-expansion-panel hideToggle (afterExpand)="showAllMessagesRead()" (afterCollapse)="startCountingUnreadMessages()" #messagesPanel>
      <mat-expansion-panel-header>
        <mat-panel-title class="blueButton">
          Messages
        </mat-panel-title>
        <mat-panel-description style="padding-right: 15px;">
          &nbsp;<ion-badge color="danger" *ngIf="unreadMessages > 0">{{ unreadMessages }}</ion-badge>
        </mat-panel-description>
      </mat-expansion-panel-header>

      <ion-list>
        <ion-item *ngFor="let message of messages" class="messageListRow">
          <ion-label class="messageItem">{{ message.sendDate | date : 'M-dd-yy HH:mm' }} - {{ message.senderID }} - {{ message.message }}</ion-label>
        </ion-item>
        <ion-item *ngIf="messages.length == 0">
          <ion-label>No messages for this Case</ion-label>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">New message</ion-label>
          <ion-input [(ngModel)]="newMessageText" (keyup.enter)="sendMessage()" (focus)="showKeyboardOnPhones($event)" (blur)="hideKeyboardOnPhones($event)" #newMessageTextbox id="newMessageTextBoxControl"></ion-input>
          <ion-button slot="end" (click)="sendMessage()">
            <ion-icon slot="icon-only" name="send"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-list>
    </mat-expansion-panel>


  </mat-accordion>

</ion-content>