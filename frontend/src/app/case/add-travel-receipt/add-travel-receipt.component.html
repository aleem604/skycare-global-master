<ion-content>

  <ion-fab vertical="top" horizontal="end" slot="fixed">
    <ion-fab-button (click)="closeTravelReceipt()">
      <ion-icon name="close"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <form [formGroup]="travelReceiptsForm">
    <ion-list>
      <ion-item-divider><ion-label>New Receipt Info</ion-label></ion-item-divider>
      <ion-item>
        <ion-grid class="flex-field-grid">
          <ion-row>
            <ion-col size="3" style="padding-top: 25px;"><ion-label>Amount</ion-label></ion-col>
            <ion-col size="3" style="padding-top: 25px;"><ion-input formControlName="amountControl" [(ngModel)]="receipt.amount" class="center-align-bordered-input" placeholder="Number" (ionChange)="calculateAmount()"></ion-input></ion-col>            
            <ion-col size="6">
              <mat-form-field class="autocomplete" appearance="standard">
                <input type="text" matInput formControlName="currencyTypeControl" [matAutocomplete]="currencyTypeCountry" [(ngModel)]="receipt.currencyType" placeholder="Currency">
              </mat-form-field>              
              <mat-autocomplete #currencyTypeCountry="matAutocomplete" (optionSelected)="calculateAmount()">
                <mat-option *ngFor="let option of (currencyTypes | async)" [value]="option">{{option}}</mat-option>
              </mat-autocomplete>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-item>
      <div class="validation-errors">
        <div class="error-message" *ngIf="receiptAmountHasError()">{{ getReceiptAmountErrorMessage() }}</div>
      </div>
      <ion-item>
        <ion-label position="stacked">Receipt Date</ion-label>
        <mat-form-field class="date-chooser">
          <input matInput 
                        formControlName="receiptDateControl" 
                        [matDatepicker]="receiptDatePicker"  
                        [(ngModel)]="receiptDateString"
                        (dateChange)="calculateAmount()">
          <mat-datepicker-toggle matSuffix [for]="receiptDatePicker">
              <mat-icon matDatepickerToggleIcon style="font-size: 35px; margin-left: -15px;">event</mat-icon>
          </mat-datepicker-toggle>
          <mat-datepicker touchUi #receiptDatePicker></mat-datepicker>
        </mat-form-field>
      </ion-item>
      <div class="validation-errors">
        <ng-container *ngFor="let validation of validationMessages.receiptDate">
          <div class="error-message" *ngIf="travelReceiptsForm.get('receiptDateControl').hasError(validation.type) && (travelReceiptsForm.get('receiptDateControl').dirty || travelReceiptsForm.get('receiptDateControl').touched)">
            {{ validation.message }}
          </div>
        </ng-container>
      </div>
      <ion-item>
        <ion-label position="fixed" style="min-width: 230px;">USD Reimbursement Amount</ion-label>
        <div>$ {{ calculatedUSDAmount }}</div>
      </ion-item>
      <ion-item>
        <ion-label position="fixed">Description</ion-label>
        <ion-input formControlName="alternateNameControl" [(ngModel)]="receipt.alternateName" placeholder="What is this receipt for"></ion-input>
      </ion-item>
      <div class="validation-errors">
        <ng-container *ngFor="let validation of validationMessages.description">
          <div class="error-message" *ngIf="travelReceiptsForm.get('alternateNameControl').hasError(validation.type) && (travelReceiptsForm.get('alternateNameControl').dirty || travelReceiptsForm.get('alternateNameControl').touched)">
            {{ validation.message }}
          </div>
        </ng-container>
      </div>
      <ion-item>
        <skycare-file-uploader filename="receipt" 
          type="escortReceipt" 
          required="true"
          formControlName="travelReceiptFileControl" 
          (onFileUploadRequested)="prepareForFileUpload($event)" 
          (onFileUploaded)="fileUploaded($event)" #travelReceiptFileControl></skycare-file-uploader>
      </ion-item>
      <div class="validation-errors">
        <ng-container *ngFor="let validation of validationMessages.travelReceiptFile">
          <div class="error-message" *ngIf="travelReceiptsForm.get('travelReceiptFileControl').hasError(validation.type) && (travelReceiptsForm.get('travelReceiptFileControl').dirty || travelReceiptsForm.get('travelReceiptFileControl').touched)">
            {{ validation.message }}
          </div>
        </ng-container>
      </div>
    </ion-list>
  </form>

</ion-content>