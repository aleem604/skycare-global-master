
mkdir -p /home/pipeline/nvm
export NVM_DIR=/home/pipeline/nvm
export NODE_VERSION=8.11.1
export NVM_VERSION=0.33.11

npm config delete prefix \
  && curl https://raw.githubusercontent.com/creationix/nvm/v${NVM_VERSION}/install.sh | sh \
  && . $NVM_DIR/nvm.sh \
  && nvm install $NODE_VERSION \
  && nvm alias default $NODE_VERSION \
  && nvm use default \
  && node -v \
  && npm -v

#export PATH=/opt/IBM/node-v6.7.0/bin:$PATH
cd server
npm install
npm run build

cd ../frontend
sed -i 's/3000/443/g' ./src/app/app.module.ts
npm install
npm install -g ionic
ionic build --prod --engine browser
cp -r ./www/* ../server/public

cd ..
cp -r ./server/* .
rm -rf ./server ./frontend
mkdir ./uploadedFiles
touch ./uploadedFiles/placeholder.txt

